<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PalmTweets">
  <link rel="apple-touch-icon" href="icons/apple-icon.png">

  <title>PalmTweets | Gateway</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div id="view-gatekeeper" class="screen active flex-col items-center justify-center p-8 bg-white text-center">
    <div class="mb-12 opacity-80 text-2xl brand-logo flex items-center justify-center leading-none">
        <span class="font-serif italic font-medium tracking-tight">Palm</span><span class="font-sans font-black -ml-1 tracking-tighter">tweets</span>
        <span class="mx-2 text-gray-300">|</span>
        <span class="text-xs font-bold tracking-widest uppercase text-gray-400">Gateway</span>
    </div>

    <h1 class="text-3xl font-extrabold text-black mb-6 tracking-tight leading-tight">
        Restricted Access Protocol
    </h1>

    <div class="max-w-xs mx-auto space-y-4 text-sm text-gray-500 leading-relaxed font-medium mb-10">
        <p>To maintain the integrity of our verified network, PalmTweets is exclusively available via Direct Access.</p>
        <p>We operate outside public marketplaces to ensure a noise-free environment strictly for university stakeholders.</p>
    </div>
    
    <div id="action-android" class="w-full max-w-xs block">
      <button id="pwa-install-btn" class="btn-black flex items-center justify-center gap-3">
        <span>Initialize App Experience</span>
        <i class="ph-bold ph-lock-key"></i>
      </button>
      <p class="mt-4 text-[10px] text-gray-400 font-bold uppercase tracking-widest">Tap to secure your pass</p>
    </div>

    <div id="action-ios" class="hidden w-full max-w-xs bg-gray-50 p-4 rounded-xl text-left border border-gray-100">
      <div class="flex items-start gap-3">
          <i class="ph-bold ph-share-network text-xl mt-1"></i>
          <div>
            <p class="text-xs font-bold text-black mb-1">To proceed:</p>
            <p class="text-xs text-gray-500">Tap the Share icon below and select <span class="font-bold text-black">'Add to Home Screen'</span>.</p>
          </div>
      </div>
      <div class="mt-3 pt-3 border-t border-gray-200 flex items-start gap-3">
          <i class="ph-bold ph-plus-square text-xl mt-1"></i>
          <p class="text-xs text-gray-500">This grants you the <span class="font-bold text-black">pass key</span> to enter the network.</p>
      </div>
      <button onclick="utils.navTo('view-intro')" class="mt-6 text-xs font-bold text-gray-400 underline block mx-auto">Continue as Guest (Preview)</button>
    </div>

    <div id="action-desktop" class="hidden w-full max-w-xs">
       <button onclick="utils.navTo('view-intro')" class="btn-black flex items-center justify-center gap-3">
         <span>Connect via Secure Terminal</span>
         <i class="ph-bold ph-desktop"></i>
       </button>
       <p class="mt-4 text-[10px] text-gray-400 font-bold uppercase tracking-widest">Web Client Authorized</p>
    </div>
  </div>

  <div id="view-intro" class="screen flex-col justify-end p-8 bg-white pb-12">
    <div class="mb-8 fade-in">
      <div class="brand-logo justify-start text-3xl mb-6">
          <span class="font-serif italic font-medium">Palm</span><span class="font-sans font-black -ml-1">tweets</span>
      </div>
      <p class="text-gray-600 text-sm leading-relaxed font-medium">
          Institutional updates, authorized opportunities from leading corporates and public bodies, and campus life & events.
      </p>
    </div>
    <div class="space-y-4 fade-in">
      <button onclick="utils.navTo('view-auth')" class="btn-black flex justify-between items-center"><span>Student Access</span> <i class="ph-bold ph-arrow-right"></i></button>
      <button onclick="utils.navTo('view-admin-auth')" class="btn-outline text-sm">Partner / Authority Access</button>
    </div>
  </div>

  <div id="view-auth" class="screen flex-col p-6 bg-white">
    <div class="h-12 mb-4"><button onclick="utils.navTo('view-intro')"><i class="ph ph-arrow-left text-xl"></i></button></div>
    <h2 class="text-3xl font-bold mb-2 tracking-tight">My Profile</h2>
    <p class="text-sm text-gray-500 mb-6 leading-relaxed">
        To ensure a noise-free experience, we require accurate data protected by strict privacy standards.
    </p>

    <div class="flex gap-4 mb-6 border-b border-gray-100 pb-2">
        <button onclick="auth.toggleTab('signup')" class="font-bold text-black text-sm uppercase tracking-wider" id="tab-signup">New Profile</button>
        <button onclick="auth.toggleTab('login')" class="text-gray-400 text-sm uppercase tracking-wider" id="tab-login">Login</button>
    </div>

    <form id="form-signup" onsubmit="auth.signup(event)" class="space-y-5">
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Email</label>
            <input id="reg-email" class="input-clean" placeholder="you@example.com" type="email" required>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Password</label>
            <input id="reg-pass" class="input-clean" placeholder="Choose a secure password" type="password" required>
        </div>
        <div class="relative">
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Campus</label>
            <select id="reg-uni" class="input-clean bg-white"></select>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Full Name</label>
            <input id="reg-name" class="input-clean" placeholder="Your Official Name" required>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Year of Study</label>
            <select id="reg-year" class="input-clean bg-white">
                <option value="1">Year 1</option><option value="2">Year 2</option><option value="3">Year 3</option><option value="4+">Year 4+</option>
            </select>
        </div>
        <button type="submit" class="btn-black mt-4">Enter Platform <i class="ph-bold ph-caret-right ml-2"></i></button>
    </form>

    <form id="form-login" onsubmit="auth.login(event)" class="space-y-5 hidden">
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Email</label>
            <input id="log-email" class="input-clean" placeholder="Email" type="email" required>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Password</label>
            <input id="log-pass" class="input-clean" placeholder="Password" type="password" required>
        </div>
        <div class="text-right">
            <button type="button" onclick="alert('Please contact feelafricaa@gmail.com for account recovery.')" class="text-xs font-bold text-gray-400 hover:text-black">Forgot Password?</button>
        </div>
        <button type="submit" class="btn-black mt-4">Enter Platform</button>
    </form>
  </div>

  <div id="view-home" class="screen flex-col bg-[#FAFAFA]">
    <header class="sticky top-0 bg-white/95 backdrop-blur border-b border-gray-100 z-40 p-4">
        <div class="flex justify-between items-center mb-3">
            <div class="text-xl brand-logo">
                <span class="font-serif italic font-medium">Palm</span><span class="font-sans font-black -ml-1">tweets</span>
            </div>
            <div class="flex gap-4">
                <button onclick="feed.loadUrgent()"><i class="ph ph-bell text-xl"></i><span id="bell-dot" class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full border border-white hidden"></span></button>
                <div class="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center font-bold text-xs cursor-pointer" onclick="auth.logout()">Me</div>
            </div>
        </div>
        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
            <button onclick="feed.filter('all', this)" class="chip active">All Updates</button>
            <button onclick="feed.filter('official', this)" class="chip">Official Notices</button>
            <button onclick="feed.filter('opportunity', this)" class="chip">Opportunities</button>
            <button onclick="feed.filter('event', this)" class="chip">Events</button>
        </div>
    </header>
    <main id="feed-list" class="flex-1 pb-20"></main>
  </div>

  <div id="view-admin-auth" class="screen flex-col p-6 bg-white">
    <div class="text-center mb-8 mt-4">
        <div class="w-16 h-16 bg-black text-white rounded-2xl mx-auto flex items-center justify-center text-3xl mb-4"><i class="ph-fill ph-shield-check"></i></div>
        <h2 class="text-2xl font-bold font-brand tracking-tight">Official Gateway</h2>
        <p class="text-gray-500 text-sm mt-3 px-2 leading-relaxed">
            The dedicated command center for authorized entities to publish verified notices and high-value opportunities.
        </p>
    </div>
    
    <div class="flex gap-4 mb-6 border-b border-gray-100 pb-2">
        <button onclick="auth.toggleAdminTab('login')" class="font-bold text-black text-sm uppercase tracking-wider" id="tab-admin-login">Login</button>
        <button onclick="auth.toggleAdminTab('signup')" class="text-gray-400 text-sm uppercase tracking-wider" id="tab-admin-signup">Create Account</button>
    </div>

    <form id="form-admin-login" onsubmit="auth.login(event, true)" class="space-y-4">
        <input id="admin-email" class="input-clean" placeholder="Official Email" type="email" required>
        <input id="admin-pass" class="input-clean" placeholder="Password" type="password" required>
        <div class="text-right">
            <button type="button" onclick="alert('Please contact feelafricaa@gmail.com for account recovery.')" class="text-xs font-bold text-gray-400 hover:text-black">Forgot Password?</button>
        </div>
        <button type="submit" class="btn-black">Login to Command Center</button>
    </form>

    <form id="form-admin-signup" onsubmit="auth.adminSignup(event)" class="space-y-4 hidden">
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Account Type</label>
            <select id="reg-admin-role" class="input-clean bg-white" onchange="auth.toggleAdminUniSelect()">
                <option value="ministry">Ministry/Student Government</option>
                <option value="official">University Office</option>
                <option value="company">Corporate / Strategic Partner</option>
                <option value="gov">Government Authority</option>
            </select>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Organization Name</label>
            <input id="reg-admin-name" class="input-clean" placeholder="e.g. CRDB Bank or Ministry of Loans" required>
        </div>
        <div id="admin-uni-wrapper">
             <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">University</label>
             <select id="reg-admin-uni" class="input-clean bg-white"></select>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Official Email</label>
            <input id="reg-admin-email" class="input-clean" placeholder="contact@org.example" type="email" required>
        </div>
        <div>
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1 block">Password</label>
            <input id="reg-admin-pass" class="input-clean" placeholder="Choose a secure password" type="password" required>
        </div>
        <button type="submit" class="btn-black mt-4">Submit for Verification</button>
    </form>
    
    <button onclick="utils.navTo('view-intro')" class="btn-outline w-full mt-4">Back to Home</button>
  </div>

  <div id="view-admin-dash" class="screen flex-col bg-[#FAFAFA]">
    <header class="bg-white border-b p-4 flex justify-between items-center sticky top-0">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-black text-white rounded-full flex items-center justify-center font-bold overflow-hidden" id="admin-avatar">A</div>
            <div>
                <div id="admin-name" class="font-bold text-sm">...</div>
                <div class="text-xs text-green-600 flex items-center gap-1"><i class="ph-fill ph-seal-check"></i> Verified Official</div>
            </div>
        </div>
        <button onclick="auth.logout()" class="p-2 bg-gray-50 rounded-full text-red-500 hover:bg-red-50"><i class="ph ph-sign-out text-xl"></i></button>
    </header>
    <main class="p-4 mb-20">
        <div>
            <h4 class="text-xs font-bold uppercase text-gray-400 tracking-wider">Performance (30 days)</h4>
            <div class="grid grid-cols-2 gap-3 mt-3">
                <div class="stat-card">
                    <div class="text-xs text-gray-500">Total Reach</div>
                    <div id="dash-reach" class="text-2xl font-extrabold mt-1">...</div>
                </div>
                <div class="stat-card">
                    <div class="text-xs text-gray-500">Avg Engagement</div>
                    <div id="dash-rate" class="text-2xl font-extrabold mt-1">...</div>
                </div>
            </div>
        </div>

        <div class="bg-black text-white rounded-2xl p-5 mt-6 flex justify-between items-center cursor-pointer shadow-lg active:scale-95 transition-transform" onclick="admin.initPost()">
            <div>
                <div class="font-bold text-lg">Create Update</div>
                <div class="text-gray-400 text-sm">Post to student feeds</div>
            </div>
            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center"><i class="ph-bold ph-plus text-xl"></i></div>
        </div>

        <div class="mt-8">
            <h4 class="text-xs font-bold uppercase text-gray-400 tracking-wider">Recent History</h4>
            <div id="admin-feed-list" class="mt-3 space-y-3"></div>
        </div>
    </main>
  </div>

  <div id="view-admin-post" class="screen flex-col p-4 bg-white">
    <div class="flex justify-between items-center mb-4">
        <button onclick="utils.navTo('view-admin-dash')" class="text-2xl"><i class="ph ph-x"></i></button>
        <h3 class="font-bold">New Update</h3>
        <button onclick="admin.publish()" class="bg-black text-white px-4 py-2 rounded-full font-bold text-sm">Post</button>
    </div>
    
    <div>
        <label class="text-xs font-bold uppercase text-gray-400 mb-1 block">Post Type</label>
        <div class="flex gap-2 mb-3">
             <label class="chip active">Normal</label>
        </div>
    </div>

    <textarea id="post-content" class="w-full h-32 bg-gray-50 border border-gray-200 rounded-xl p-4 text-sm outline-none resize-none" placeholder="What's happening?"></textarea>
    
    <div class="mt-4 pb-4 border-b border-gray-100">
        <input type="file" id="post-files" multiple accept="image/*,.pdf" class="hidden" onchange="admin.handleFiles(this)">
        <div class="flex gap-3">
            <button class="upload-btn flex-1 text-sm" onclick="document.getElementById('post-files').click()">
                <i class="ph-fill ph-image text-lg"></i> Add Photos
            </button>
            <button class="upload-btn flex-1 text-sm" onclick="document.getElementById('post-files').click()">
                <i class="ph-fill ph-file-pdf text-lg"></i> Add Documents
            </button>
        </div>
        <div id="file-preview-area" class="flex gap-2 overflow-x-auto mt-3 no-scrollbar"></div>
    </div>

    <div class="mt-4 space-y-4">
        <div>
            <label class="text-xs font-bold uppercase text-gray-400 block mb-1">Category</label>
            <select id="post-category" class="input-clean py-2 bg-white">
                <option value="official">Official Notice</option>
                <option value="opportunity">Opportunity</option>
                <option value="event">Event</option>
            </select>
        </div>
        
        <div id="targeting-box" class="hidden">
            <label class="text-xs font-bold uppercase tracking-wider text-gray-400 block mb-1">Target Audience</label>
            <select id="post-targets" class="input-clean h-24" multiple></select>
            <p class="text-[10px] text-gray-400 mt-1">Hold Ctrl/Cmd to select multiple.</p>
        </div>

        <div>
            <label class="text-xs font-bold uppercase text-gray-400 block mb-2">Priority Level</label>
            <div class="grid grid-cols-3 gap-2">
                <button type="button" class="urgency-btn active text-sm" onclick="admin.setUrgency('INFO', this)">Info</button>
                <button type="button" class="urgency-btn text-sm" onclick="admin.setUrgency('IMPORTANT', this)">Important</button>
                <button type="button" class="urgency-btn text-sm" onclick="admin.setUrgency('URGENT', this)">Urgent</button>
            </div>
            <input id="post-tag" type="hidden" value="INFO" />
        </div>
    </div>
  </div>

  <div id="comment-modal" class="overlay flex items-end justify-center hidden" onclick="feed.closeComments()">
    <div class="sheet-bottom animate-slide-up" onclick="event.stopPropagation()">
        <div class="p-4 border-b border-gray-100 flex justify-between items-center">
            <div class="font-bold text-sm">Comments <span id="comment-header-count" class="text-gray-400 font-normal">(0)</span></div>
            <button onclick="feed.closeComments()"><i class="ph ph-x text-xl"></i></button>
        </div>
        <div id="comments-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50"></div>
        
        <div id="reply-indicator" class="hidden bg-gray-100 p-2 text-xs flex justify-between px-4 border-t border-gray-200">
            <span>Replying to...</span><button onclick="feed.cancelReply()" class="font-bold">Cancel</button>
        </div>
        
        <div class="p-3 border-t border-gray-100 bg-white flex gap-2 items-center pb-6">
            <input id="comment-input" class="flex-1 bg-gray-100 rounded-full px-4 py-3 text-sm outline-none" placeholder="Add a comment...">
            <button onclick="feed.postComment()" class="text-black font-bold text-sm p-2">Post</button>
        </div>
    </div>
  </div>

  <div id="toast-box"></div>
  <script type="module" src="js/app.js"></script>
</body>
</html>
